name: Weekly Analytics Report

on:
  schedule:
    # Run every Monday at 9 AM UTC
    - cron: "0 9 * * 1"
  workflow_dispatch: # Allow manual trigger

jobs:
  weekly-report:
    runs-on: ubuntu-latest
    name: Generate Weekly Report

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate Weekly Stats
        uses: malcohelper/git-scout/.github/actions/git-scout@main
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          command: "stats --since 7d --json"
          post-comment: "false"

      - name: Create Issue with Report
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const title = `ðŸ“Š Weekly Analytics Report - ${new Date().toISOString().split('T')[0]}`;
            const body = `## Weekly Development Summary

            This is an automated weekly report generated by Git Scout.

            ### Key Metrics
            - Report generated on: ${new Date().toLocaleString()}
            - Analysis period: Last 7 days

            ### Actions
            - Review team productivity
            - Identify bottlenecks
            - Plan next week's priorities

            ---
            *Automated by Git Scout Analytics*`;

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['analytics', 'weekly-report']
            });
